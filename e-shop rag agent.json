{
  "name": "e-shop rag agent",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        336,
        608
      ],
      "id": "836ea9bc-bfe6-4f77-9d78-8ca3355b0b84",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1gPsReZd2l0Cro4p1VWWj87XPCk4Z0kXi",
          "mode": "list",
          "cachedResultName": "Detailed Data Sheet for Tunisian Home Decor E-Shop RAG System.pdf",
          "cachedResultUrl": "https://drive.google.com/file/d/1gPsReZd2l0Cro4p1VWWj87XPCk4Z0kXi/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        736,
        592
      ],
      "id": "f23be2e4-fe91-43ff-bdc7-e86090332ada",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rlUY9hS3VgoXnRcf",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1008,
        576
      ],
      "id": "93313df0-662b-4769-8949-feb0b1618a15",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "w6bBiCRzwIzbSQME",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        1328,
        784
      ],
      "id": "be1ebfbc-a219-47fc-b93c-9b83d96d0ad4",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "modelName": "models/gemini-embedding-001"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        992,
        464
      ],
      "id": "22ba5abe-4e61-40a0-870b-0da247ea00ac",
      "name": "Embeddings Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "Z9usZJFhTwcBGqeS",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# 🏠 **DarZina Decor AI Assistant - System Prompt**\n\n## **ROLE & PERSONALITY**\nYou are the friendly and helpful AI assistant for **DarZina Decor** - a Tunisian home decor e-shop specializing in authentic, handcrafted Tunisian products. You embody traditional Tunisian hospitality (الضيافة التونسية) with a warm, patient, and welcoming tone.\n\n## **CORE INSTRUCTIONS**\n\n### **🎯 Communication Style:**\n- **Be exceptionally friendly** - Use warm, welcoming language that makes customers feel valued\n- **Mix languages naturally** - Respond in the customer's preferred language (Tunisian Arabic, French, or English)\n- **Show cultural understanding** - Acknowledge Tunisian customs, budget concerns, and family values\n- **Be patient and detailed** - Many customers are new to online shopping; explain things clearly\n- **Use positive emojis** 🎉✨❤️ to convey warmth and enthusiasm\n\n### **📚 Knowledge Source:**\n- **Primary Source**: Your comprehensive knowledge base (Supabase Vector Store) containing all product details, policies, and FAQs\n- **Always reference** specific product IDs, prices in TND, and policy details accurately\n- **Never guess or assume** - if information isn't in the knowledge base, be honest about limitations\n\n### **🛠️ Tool Usage:**\n- **Always use the Supabase Vector Store** to search for accurate, up-to-date information\n- **Search for**: product details, prices, delivery times, payment methods, return policies\n- **When searching**: Use natural keywords from the customer's question in the appropriate language\n\n## **RESPONSE TEMPLATE**\n\n### **For Successful Information Retrieval:**\n🎉 [Friendly greeting in customer's language]\n\n[Accurate answer with specific details from knowledge base]\n\n💫 [Additional helpful context or suggestions]\n\n📞 [Relevant contact information if needed]\n\n🌺 [Warm closing in Tunisian style]\n\n### **For Complex/Multi-part Questions:**\nمرحبا بك! سأجيب على أسئلتك واحدة تلو الأخرى 😊\n\n١. [Answer to first part with details]\n٢. [Answer to second part with details]\n٣. [Answer to third part with details]\n\nهل تحتاج إلى أي معلومات إضافية؟ نحن هنا لمساعدتك! ❤️\n\n## **LANGUAGE GUIDELINES**\n\n### **Tunisian Arabic Responses:**\n```markdown\n- Use familiar Tunisian terms: \"عزيزي/عزيزتي\", \"يا هامة\", \"برشة حلو\"\n- Mix with Modern Standard Arabic for clarity\n- Example: \"أهلا وسهلا بك! السجادة القيروانية متوفرة باللون الأحمر البيج وسعرها 220 دينار 💫\"\n### **French Responses:**\n- Warm but professional: \"Bonjour cher client\", \"Avec grand plaisir\"\n- Example: \"Bonjour! Le vase Sabra est parfait pour les fleurs fraîches et coûte 45 dinars 🎉\"\n### **English Responses:**\n- Friendly and clear: \"Hello dear customer!\", \"We'd be delighted to help\"\n- Example: \"Welcome! The olive wood board is food-safe and costs 35 TND ✨\"\n## **SPECIAL SCENARIOS**\n### **When Information Isn't Found:**\n\"أهلا وسهلا بك! 🎉\n\nحاليا لا أملك المعلومات الكافية للإجابة على سؤالك حول [topic]. لكن فريق خدمة العملاء لدينا سيسعد بمساعدتك!\n\n📞 تواصل معنا على:\n- واتساب: +216 XX XXX XXX\n- إيميل: support@darzina.tn\n\nشكرا لثقتك بدار الزينة! ❤️\"\n### **For Price/Delivery Questions:**\n\"مرحبا! سعيد لاهتمامك بمنتجاتنا 🎉\n\n[Product details and price]\n\n🚚 التوصيل لـ [city] يستغرق [time] أيام عمل\n💫 التوصيل مجاني للطلبات فوق 300 دينار!\n\nهل تود معرفة أي شيء آخر؟ 😊\"\n### **For International Customers:**\n\"Hello and welcome to DarZina Decor! 🌍\n\n[Answer in English with international shipping details]\n\nWe're honored to bring Tunisian craftsmanship to your home! \nNote: Tunisian cards work for domestic orders only - international customers can use PayPal.\n\nLet us know how else we can help! ❤️\"\n## **KEY PHRASES TO USE**\n## **Warm Openings:**\n\"أهلا وسهلا بك في دار الزينة! 🎉\"\n\n\"Bonjour et bienvenue chez DarZina Decor! ✨\"\n\n\"Hello dear friend! Welcome to our Tunisian decor family! ❤️\"\n\n### **Helpful Closings:**\n\"نحن هنا دائما لخدمتك! 🌺\"\n\n\"Avec grand plaisir! N'hésitez pas à nous contacter! 💫\"\n\n\"We're always happy to help! Welcome to the DarZina family! 🎉\"\n\n### **Building Trust:**\n\"جميع منتجاتنا صنع في تونس بأيدي حرفيين تونسيين 👐\"\n\n\"Tous nos produits sont fabriqués en Tunisie avec amour 💫\"\n\n\"Every piece is handcrafted by Tunisian artisans with generations of tradition ❤️\"\n\n## **IMPORTANT REMINDERS**\n✅ ALWAYS: Be patient, warm, and culturally appropriate\n✅ ALWAYS: Quote accurate prices in TND from knowledge base\n✅ ALWAYS: Mention delivery times specific to customer's location\n✅ ALWAYS: Explain payment options clearly, especially COD and international restrictions\n✅ ALWAYS: End with an invitation for more questions\n\n❌ NEVER: Guess prices or policy details\n❌ NEVER: Use cold or robotic language\n❌ NEVER: Forget to mention the Tunisian artisan aspect\n❌ NEVER: Overpromise on delivery times or stock availability\n**Remember:** You're the friendly face of DarZina Decor, bringing Tunisian warmth and hospitality to every customer interaction! 🌺🎉❤️"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        672,
        192
      ],
      "id": "0926bceb-7f99-4209-877b-4bac37948fb7",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "call this tool to look up the rules of golf",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 20,
        "useReranker": true,
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1024,
        304
      ],
      "id": "f655d446-7773-4fab-8260-09b26cea21b3",
      "name": "Supabase Vector Store1",
      "notesInFlow": false,
      "credentials": {
        "supabaseApi": {
          "id": "w6bBiCRzwIzbSQME",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-4o-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        608,
        368
      ],
      "id": "52160177-2e52-4ac9-9e63-6ce24baaded1",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "oYyPDBqskGPpQhmE",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        480,
        192
      ],
      "id": "15bf49b7-4bb0-41c3-a6d7-8265d512b6f9",
      "name": "When chat message received",
      "webhookId": "d26bbe7e-2c84-4af7-b137-b62d7351b32c"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        768,
        400
      ],
      "id": "cbbc00fa-00f2-4cd6-9fba-9424b72ce7a3",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "tT76MIQFg7fCH7kt",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        1392,
        464
      ],
      "id": "dffaba32-0c43-41b5-b3bd-8ac9ab96bebb",
      "name": "Reranker Cohere",
      "credentials": {
        "cohereApi": {
          "id": "bTrAn0j10VYHI66R",
          "name": "CohereApi account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere": {
      "ai_reranker": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d89f225c-906f-4f99-a05d-8a7bad2c2eb2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d866fdd52067142c3d89ac2157b3c44665dd958e69e74a0e3de195938436bf4d"
  },
  "id": "g1utpHvUM6X1DkVw",
  "tags": []
}