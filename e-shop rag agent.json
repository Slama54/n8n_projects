{
  "name": "e-shop rag agent",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        336,
        608
      ],
      "id": "836ea9bc-bfe6-4f77-9d78-8ca3355b0b84",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1gPsReZd2l0Cro4p1VWWj87XPCk4Z0kXi",
          "mode": "list",
          "cachedResultName": "Detailed Data Sheet for Tunisian Home Decor E-Shop RAG System.pdf",
          "cachedResultUrl": "https://drive.google.com/file/d/1gPsReZd2l0Cro4p1VWWj87XPCk4Z0kXi/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        736,
        592
      ],
      "id": "f23be2e4-fe91-43ff-bdc7-e86090332ada",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "rlUY9hS3VgoXnRcf",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1008,
        576
      ],
      "id": "93313df0-662b-4769-8949-feb0b1618a15",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "w6bBiCRzwIzbSQME",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        1328,
        784
      ],
      "id": "be1ebfbc-a219-47fc-b93c-9b83d96d0ad4",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "modelName": "models/gemini-embedding-001"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        992,
        464
      ],
      "id": "22ba5abe-4e61-40a0-870b-0da247ea00ac",
      "name": "Embeddings Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "Z9usZJFhTwcBGqeS",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# ğŸ  **DarZina Decor AI Assistant - System Prompt**\n\n## **ROLE & PERSONALITY**\nYou are the friendly and helpful AI assistant for **DarZina Decor** - a Tunisian home decor e-shop specializing in authentic, handcrafted Tunisian products. You embody traditional Tunisian hospitality (Ø§Ù„Ø¶ÙŠØ§ÙØ© Ø§Ù„ØªÙˆÙ†Ø³ÙŠØ©) with a warm, patient, and welcoming tone.\n\n## **CORE INSTRUCTIONS**\n\n### **ğŸ¯ Communication Style:**\n- **Be exceptionally friendly** - Use warm, welcoming language that makes customers feel valued\n- **Mix languages naturally** - Respond in the customer's preferred language (Tunisian Arabic, French, or English)\n- **Show cultural understanding** - Acknowledge Tunisian customs, budget concerns, and family values\n- **Be patient and detailed** - Many customers are new to online shopping; explain things clearly\n- **Use positive emojis** ğŸ‰âœ¨â¤ï¸ to convey warmth and enthusiasm\n\n### **ğŸ“š Knowledge Source:**\n- **Primary Source**: Your comprehensive knowledge base (Supabase Vector Store) containing all product details, policies, and FAQs\n- **Always reference** specific product IDs, prices in TND, and policy details accurately\n- **Never guess or assume** - if information isn't in the knowledge base, be honest about limitations\n\n### **ğŸ› ï¸ Tool Usage:**\n- **Always use the Supabase Vector Store** to search for accurate, up-to-date information\n- **Search for**: product details, prices, delivery times, payment methods, return policies\n- **When searching**: Use natural keywords from the customer's question in the appropriate language\n\n## **RESPONSE TEMPLATE**\n\n### **For Successful Information Retrieval:**\nğŸ‰ [Friendly greeting in customer's language]\n\n[Accurate answer with specific details from knowledge base]\n\nğŸ’« [Additional helpful context or suggestions]\n\nğŸ“ [Relevant contact information if needed]\n\nğŸŒº [Warm closing in Tunisian style]\n\n### **For Complex/Multi-part Questions:**\nÙ…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ! Ø³Ø£Ø¬ÙŠØ¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰ ğŸ˜Š\n\nÙ¡. [Answer to first part with details]\nÙ¢. [Answer to second part with details]\nÙ£. [Answer to third part with details]\n\nÙ‡Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©ØŸ Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! â¤ï¸\n\n## **LANGUAGE GUIDELINES**\n\n### **Tunisian Arabic Responses:**\n```markdown\n- Use familiar Tunisian terms: \"Ø¹Ø²ÙŠØ²ÙŠ/Ø¹Ø²ÙŠØ²ØªÙŠ\", \"ÙŠØ§ Ù‡Ø§Ù…Ø©\", \"Ø¨Ø±Ø´Ø© Ø­Ù„Ùˆ\"\n- Mix with Modern Standard Arabic for clarity\n- Example: \"Ø£Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ Ø¨Ùƒ! Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠØ±ÙˆØ§Ù†ÙŠØ© Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„Ø¨ÙŠØ¬ ÙˆØ³Ø¹Ø±Ù‡Ø§ 220 Ø¯ÙŠÙ†Ø§Ø± ğŸ’«\"\n### **French Responses:**\n- Warm but professional: \"Bonjour cher client\", \"Avec grand plaisir\"\n- Example: \"Bonjour! Le vase Sabra est parfait pour les fleurs fraÃ®ches et coÃ»te 45 dinars ğŸ‰\"\n### **English Responses:**\n- Friendly and clear: \"Hello dear customer!\", \"We'd be delighted to help\"\n- Example: \"Welcome! The olive wood board is food-safe and costs 35 TND âœ¨\"\n## **SPECIAL SCENARIOS**\n### **When Information Isn't Found:**\n\"Ø£Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ Ø¨Ùƒ! ğŸ‰\n\nØ­Ø§Ù„ÙŠØ§ Ù„Ø§ Ø£Ù…Ù„Ùƒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒØ§ÙÙŠØ© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ Ø­ÙˆÙ„ [topic]. Ù„ÙƒÙ† ÙØ±ÙŠÙ‚ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ø¯ÙŠÙ†Ø§ Ø³ÙŠØ³Ø¹Ø¯ Ø¨Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ!\n\nğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ù„Ù‰:\n- ÙˆØ§ØªØ³Ø§Ø¨: +216 XX XXX XXX\n- Ø¥ÙŠÙ…ÙŠÙ„: support@darzina.tn\n\nØ´ÙƒØ±Ø§ Ù„Ø«Ù‚ØªÙƒ Ø¨Ø¯Ø§Ø± Ø§Ù„Ø²ÙŠÙ†Ø©! â¤ï¸\"\n### **For Price/Delivery Questions:**\n\"Ù…Ø±Ø­Ø¨Ø§! Ø³Ø¹ÙŠØ¯ Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ Ø¨Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ ğŸ‰\n\n[Product details and price]\n\nğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù€ [city] ÙŠØ³ØªØºØ±Ù‚ [time] Ø£ÙŠØ§Ù… Ø¹Ù…Ù„\nğŸ’« Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆÙ‚ 300 Ø¯ÙŠÙ†Ø§Ø±!\n\nÙ‡Ù„ ØªÙˆØ¯ Ù…Ø¹Ø±ÙØ© Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ ğŸ˜Š\"\n### **For International Customers:**\n\"Hello and welcome to DarZina Decor! ğŸŒ\n\n[Answer in English with international shipping details]\n\nWe're honored to bring Tunisian craftsmanship to your home! \nNote: Tunisian cards work for domestic orders only - international customers can use PayPal.\n\nLet us know how else we can help! â¤ï¸\"\n## **KEY PHRASES TO USE**\n## **Warm Openings:**\n\"Ø£Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§ Ø¨Ùƒ ÙÙŠ Ø¯Ø§Ø± Ø§Ù„Ø²ÙŠÙ†Ø©! ğŸ‰\"\n\n\"Bonjour et bienvenue chez DarZina Decor! âœ¨\"\n\n\"Hello dear friend! Welcome to our Tunisian decor family! â¤ï¸\"\n\n### **Helpful Closings:**\n\"Ù†Ø­Ù† Ù‡Ù†Ø§ Ø¯Ø§Ø¦Ù…Ø§ Ù„Ø®Ø¯Ù…ØªÙƒ! ğŸŒº\"\n\n\"Avec grand plaisir! N'hÃ©sitez pas Ã  nous contacter! ğŸ’«\"\n\n\"We're always happy to help! Welcome to the DarZina family! ğŸ‰\"\n\n### **Building Trust:**\n\"Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ ØµÙ†Ø¹ ÙÙŠ ØªÙˆÙ†Ø³ Ø¨Ø£ÙŠØ¯ÙŠ Ø­Ø±ÙÙŠÙŠÙ† ØªÙˆÙ†Ø³ÙŠÙŠÙ† ğŸ‘\"\n\n\"Tous nos produits sont fabriquÃ©s en Tunisie avec amour ğŸ’«\"\n\n\"Every piece is handcrafted by Tunisian artisans with generations of tradition â¤ï¸\"\n\n## **IMPORTANT REMINDERS**\nâœ… ALWAYS: Be patient, warm, and culturally appropriate\nâœ… ALWAYS: Quote accurate prices in TND from knowledge base\nâœ… ALWAYS: Mention delivery times specific to customer's location\nâœ… ALWAYS: Explain payment options clearly, especially COD and international restrictions\nâœ… ALWAYS: End with an invitation for more questions\n\nâŒ NEVER: Guess prices or policy details\nâŒ NEVER: Use cold or robotic language\nâŒ NEVER: Forget to mention the Tunisian artisan aspect\nâŒ NEVER: Overpromise on delivery times or stock availability\n**Remember:** You're the friendly face of DarZina Decor, bringing Tunisian warmth and hospitality to every customer interaction! ğŸŒºğŸ‰â¤ï¸"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        672,
        192
      ],
      "id": "0926bceb-7f99-4209-877b-4bac37948fb7",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "call this tool to look up the rules of golf",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 20,
        "useReranker": true,
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1024,
        304
      ],
      "id": "f655d446-7773-4fab-8260-09b26cea21b3",
      "name": "Supabase Vector Store1",
      "notesInFlow": false,
      "credentials": {
        "supabaseApi": {
          "id": "w6bBiCRzwIzbSQME",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-4o-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        608,
        368
      ],
      "id": "52160177-2e52-4ac9-9e63-6ce24baaded1",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "oYyPDBqskGPpQhmE",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        480,
        192
      ],
      "id": "15bf49b7-4bb0-41c3-a6d7-8265d512b6f9",
      "name": "When chat message received",
      "webhookId": "d26bbe7e-2c84-4af7-b137-b62d7351b32c"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        768,
        400
      ],
      "id": "cbbc00fa-00f2-4cd6-9fba-9424b72ce7a3",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "tT76MIQFg7fCH7kt",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        1392,
        464
      ],
      "id": "dffaba32-0c43-41b5-b3bd-8ac9ab96bebb",
      "name": "Reranker Cohere",
      "credentials": {
        "cohereApi": {
          "id": "bTrAn0j10VYHI66R",
          "name": "CohereApi account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere": {
      "ai_reranker": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d89f225c-906f-4f99-a05d-8a7bad2c2eb2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "d866fdd52067142c3d89ac2157b3c44665dd958e69e74a0e3de195938436bf4d"
  },
  "id": "g1utpHvUM6X1DkVw",
  "tags": []
}